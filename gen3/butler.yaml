datastore:
  root: <butlerRoot>
  formatters:
    # Override the default Exposure formatter
    DecoratedImageU: lsst.obs.pfs.formatters.PfsFitsExposureFormatter
    Exposure: lsst.obs.pfs.formatters.PfsFitsExposureFormatter
    ExposureF: lsst.obs.pfs.formatters.PfsFitsExposureFormatter
    ExposureI: lsst.obs.pfs.formatters.PfsFitsExposureFormatter

    # PFS-specific dataset types
    PfsRaw: lsst.obs.pfs.formatters.PfsRawFormatter
    PfsConfig: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    FiberProfileSet: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    FiberTraceSet: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    PfsFiberNorms: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    DetectorMap: lsst.obs.pfs.formatters.DetectorMapFormatter
    PfsArm: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    PfsMerged: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    PfsFluxReference: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    PfsSingle: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    PfsObject: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    SkyModel: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    FocalPlaneFunction: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    ArcLineSet: lsst.obs.base.formatters.fitsGeneric.FitsGenericFormatter
    LsfDict: lsst.daf.butler.formatters.pickle.PickleFormatter
    Lsf: lsst.daf.butler.formatters.pickle.PickleFormatter
    NevenPsf: lsst.daf.butler.formatters.pickle.PickleFormatter
    MultipagePdfFigure: pfs.drp.qa.formatters.PdfMatplotlibFormatter
    QaDict: lsst.daf.butler.formatters.pickle.PickleFormatter
  templates:
    instrument+detector+dither: "{run:/}/{datasetType}.{component:?}/{datasetType}_{component:?}_{instrument:?}_{dither:?}_{detector.full_name:?}_{run}"
    instrument+detector+pfs_design_id: "{run:/}/{datasetType}.{component:?}/{datasetType}_{component:?}_{instrument:?}_{detector.full_name:?}_{pfs_design_id:?}_{run}"
    instrument+exposure+arm:  "{run:/}/{datasetType}.{component:?}/{datasetType}_{component:?}_{instrument:?}_{exposure:?}_{arm:?}_{run}"
    instrument+arm: "{run:/}/{datasetType}.{component:?}/{datasetType}_{component:?}_{instrument:?}_{arm:?}_{run}"
    instrument+cat_id+obj_id: "{run:/}/{datasetType}.{component:?}/{cat_id:?}/{datasetType}_{component:?}_{instrument:?}_{cat_id:?}_{obj_id:?}_{run}"
    instrument+cat_id+obj_id+exposure: "{run:/}/{datasetType}.{component:?}/{exposure:?}/{cat_id:?}/{datasetType}_{component:?}_{instrument:?}_{cat_id:?}_{obj_id:?}_{exposure:?}_{run}"
    instrument+cat_id: "{run:/}/{datasetType}.{component:?}/{datasetType}_{component:?}_{instrument:?}_{cat_id:?}_{run}"

registry:
  db: sqlite:///<butlerRoot>/gen3.sqlite3
storageClasses:
  PfsConfig:
    pytype: pfs.drp.stella.datamodel.PfsConfig
  FiberProfileSet:
    pytype: pfs.drp.stella.FiberProfileSet
  FiberTraceSet:
    pytype: pfs.drp.stella.FiberTraceSet
  PfsFiberNorms:
    pytype: pfs.drp.stella.datamodel.PfsFiberNorms
  DetectorMap:
    pytype: pfs.drp.stella.DetectorMap
    components:
      slitOffsets: NumpyArray  # Slit offsets
      bbox: Box2I  # Bounding box
  PfsArm:
    pytype: pfs.drp.stella.datamodel.PfsArm
  PfsMerged:
    pytype: pfs.drp.stella.datamodel.PfsMerged
  PfsFluxReference:
    pytype: pfs.datamodel.pfsFluxReference.PfsFluxReference
  PfsSingle:
    pytype: pfs.drp.stella.datamodel.PfsSingle
  PfsObject:
    pytype: pfs.drp.stella.datamodel.PfsObject
  SkyModel:
    pytype: pfs.drp.stella.sky2d.SkyModel
  FocalPlaneFunction:
    pytype: pfs.drp.stella.focalPlaneFunction.FocalPlaneFunction
  ArcLineSet:
    pytype: pfs.drp.stella.arcLine.ArcLineSet
  LsfDict:
    pytype: pfs.drp.stella.lsf.LsfDict
  Lsf:
    pytype: pfs.drp.stella.lsf.Lsf
  NevenPsf:
    pytype: pfs.drp.stella.NevenPsfContinued.NevenPsf
  MultipagePdfFigure:
    pytype: pfs.drp.qa.storageClasses.MultipagePdfFigure
  QaDict:
    pytype: pfs.drp.qa.storageClasses.QaDict
  PfsRaw:
    pytype: lsst.obs.pfs.raw.PfsRaw
    parameters:
      - bbox  # Bounding box to read (Box2I)
      - readNum  # Read number of NIR ramp (int)
    components:
      exposure: Exposure  # CCD image or NIR CDS image, as an Exposure (like for a "raw")
      image: Image  # CCD image or NIR CDS image
      ramp: Image  # NIR ramp read image; requires readNum
      numReads: int  # Number of NIR ramp reads
      metadata: PropertyList  # header
      visitInfo: VisitInfo  # parsed visit information
      detector: Detector
      id: int  # exposure ID
      bbox: Box2I  # bounding box
      dimensions: Extent2I  # size of image
      xy0: Point2I  # bounding box origin
